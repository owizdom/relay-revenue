<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MEV Revenue</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <style>
      :root {
        --bg: #0b0f14;
        --panel: #0f141b;
        --text: #e6edf3;
        --muted: #9aa4af;
        --accent: #61dafb;
        --bar: #1f2937;
        --barFill: #22c55e;
        --border: #1e293b;
      }
      html, body { background: var(--bg); color: var(--text); font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .hero { padding: 40px 20px 24px; background: linear-gradient(180deg, rgba(97,218,251,0.06), rgba(97,218,251,0) 60%); border-bottom: 1px solid var(--border); }
      .brand { display:flex; align-items:center; gap:10px; font-weight:600; font-size:14px; color: var(--muted); }
      .title { font-size:28px; font-weight:700; margin: 6px 0 6px; letter-spacing: .2px; }
      .subtitle { color: var(--muted); font-size: 13px; }
      .content { padding: 18px 20px 40px; }
      .cards { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:14px; margin-top: 12px; }
      .card { background: var(--panel); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
      .card .label { color: var(--muted); font-size: 12px; margin-bottom: 8px; }
      .card .value { font-weight: 700; font-size: 22px; }
      .panel { margin-top: 18px; background: var(--panel); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
      table { width: 100%; border-collapse: collapse; font-size: 14px; }
      th, td { padding: 10px 10px; border-bottom: 1px solid var(--border); }
      th { color: var(--muted); font-weight: 600; text-align: left; }
      .right { text-align: right; }
      .bar { height: 10px; background: var(--bar); border-radius: 6px; overflow: hidden; }
      .bar > div { height: 100%; background: var(--barFill); }
      .muted { color: var(--muted); font-size: 12px; }
      .seg a { color: var(--muted); text-decoration: none; margin: 0 6px; }
      .seg a.active { color: var(--text); font-weight: 600; }
      .tabs { margin-top:14px; }
      .tabs a { color: var(--muted); text-decoration:none; margin-right:14px; }
      .tabs a.active { color: var(--text); font-weight:600; }
    </style>
  </head>
  <body>
    <div class="hero">
      <div class="brand"><i class="bi bi-lightning-charge-fill" style="color:var(--accent);"></i> mev-revenue</div>
      <div class="title">Relay-Revenue Metrics</div>
      <div class="subtitle">Recent builder/relay revenue from public MEV-Boost relays • <span id="updated"></span></div>
      <div class="cards">
        <div class="card"><div class="label">Total Revenue (ETH)</div><div class="value" id="total">—</div></div>
        <div class="card"><div class="label">Relays</div><div class="value" id="relays">—</div></div>
        <div class="card"><div class="label">Top Share</div><div class="value" id="topshare">—</div></div>
      </div>
      
      <div class="tabs" id="tabs">
        <a href="#" data-tab="revenue" class="active">Revenue</a>
        <a href="#" data-tab="about">About</a>
      </div>
    </div>

    <div class="content">
      <div class="panel" id="panel-revenue">
        <div class="muted" style="margin-bottom:8px;">Revenue by relay</div>
        <table>
          <thead>
            <tr><th>Relay</th><th class="right">ETH</th><th class="right" style="min-width:180px;">Percent</th></tr>
          </thead>
          <tbody id="tbody-revenue"></tbody>
        </table>
        <div class="muted" style="margin-top:10px;">⚠︎ Heuristic: sums recent delivered payload fields exposed by relays (value/block_value/profit).</div>
      </div>
      <div class="panel" id="panel-about" style="display:none;">
        <div class="muted" style="margin-bottom:8px;">About</div>
        <p style="margin:0 0 10px;">this dashboard provides transparent, data-driven insights into mev revenue captured through mev boost. it aggregates payload traces from public relay endpoints such as flashbots, titanrelay, ultrasound, aestus, and agnostic to approximate total mev distribution across the network. all figures are derived from publicly exposed fields like <span style="color:#22c55e; font-weight:600;">value</span>, <span style="color:#22c55e; font-weight:600;">block_value</span>, and <span style="color:#22c55e; font-weight:600;">profit</span>, representing best-effort estimates based on available data.</p>
        <p style="margin:0 0 10px;">while every effort is made to ensure accuracy, limitations such as off chain payments, alternative payout routes, and incomplete relay data may introduce bias or underestimation. this tool aims to make mev activity more observable and verifiable through open, reproducible data.</p>
        <p class="muted" style="margin:8px 0 0;">Built by Decentralised.Co</p>
      </div>
    </div>

    <script>
      async function loadRevenue() {
        const res = await fetch('/api/revenue');
        const data = await res.json();
        const items = data.items || [];
        const total = items.reduce((s,x)=> s + (x.eth||0), 0);
        const relays = items.length;
        const top = items.length ? Math.max(...items.map(x => x.eth||0)) : 0;
        const topPct = total > 0 ? (100 * top / total) : 0;
        document.getElementById('total').textContent = `${total.toFixed(4)} ETH`;
        document.getElementById('relays').textContent = String(relays);
        document.getElementById('topshare').textContent = `${topPct.toFixed(1)}%`;
        document.getElementById('updated').textContent = 'just now';
        const tbody = document.getElementById('tbody-revenue');
        tbody.innerHTML = '';
        items.sort((a,b)=> (b.eth||0) - (a.eth||0)).forEach(x => {
          const eth = (x.eth||0);
          const pct = total > 0 ? (100 * eth / total) : 0;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${x.relay}</td>
                          <td class='right'>${eth.toFixed(4)}</td>
                          <td class='right'>
                            <div style='display:flex; align-items:center; gap:8px; justify-content:flex-end;'>
                              <span class='tiny' style='width:44px;'>${pct.toFixed(2)}%</span>
                              <div class='bar' style='width:150px;'><div style='width:${pct.toFixed(2)}%'></div></div>
                            </div>
                          </td>`;
          tbody.appendChild(tr);
        });
      }

      

      // Tabs
      document.querySelectorAll('#tabs a').forEach(a => {
        a.onclick = (e) => {
          e.preventDefault();
          document.querySelectorAll('#tabs a').forEach(x=>x.classList.remove('active'));
          a.classList.add('active');
          const tab = a.getAttribute('data-tab');
          document.getElementById('panel-revenue').style.display = (tab === 'revenue') ? 'block' : 'none';
          document.getElementById('panel-about').style.display = (tab === 'about') ? 'block' : 'none';
        };
      });

      loadRevenue();
      setInterval(loadRevenue, 30000);
    </script>
  </body>
  </html>


